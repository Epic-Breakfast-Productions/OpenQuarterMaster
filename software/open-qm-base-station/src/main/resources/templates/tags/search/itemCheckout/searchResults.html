{@tech.ebp.oqm.baseStation.service.mongo.search.SearchResult<tech.ebp.oqm.lib.core.object.storage.checkout.ItemCheckout> searchResults}
{@tech.ebp.oqm.baseStation.service.mongo.search.PagingCalculations pagingCalculations}
{!
  Template to show storage search results. Gives the contents of a table, but not the main table tag

  Ingests:
  - actionType - the action to take. "full" or "select"
  - storageService - the service to get storage blocks
  - searchResults
  - searchFormId - the id of the search form controlling the results
  - inputIdPrepend - the prepend for the id of the inputs to set the data of
  - otherModalId - the id of the other modal to open when selected

  if `actionType` is "select", callback will be "selectStorageBlock('<block name>', '<block id>', '<inputIdPrepend>')" on the select button
!}
  <thead>
  <tr>
    <td colspan="7" class="text-center">
      {#paginationButtons searchFormId=searchFormId pagingCalculations=pagingCalculations}{/paginationButtons}
    </td>
  </tr>
  <tr>
    {#if showItem}<th scope="col">{#icons/item}{/icons/item} Item</th>{/if}
    {#if showStillCheckedOut}<th scope="col">Status</th>{/if}
    <th scope="col">{#icons/storageBlock}{/icons/storageBlock} From</th>
    <th scope="col">For</th>
    <th scope="col">By</th>
    <th scope="col">Due Back</th>
    <th scope="col" width="125px">Actions</th>
  </tr>
  </thead>
  <tbody>
  {#if searchResults.getResults().isEmpty()}
  <tr>
    <td colspan="7" class="text-center">
      <h2>
        No Checkouts Found
      </h2>
      <p>
        Checkout an item on the {#links/inventoryItems}{/links/inventoryItems} page!
      </p>
    </td>
  </tr>
  {#else}
  {#for result in searchResults.getResults()}
  <tr class="align-middle">
    {#if showItem}
    <td>
      {#links/inventoryItem inventoryItem=result.getItem()}{/links/inventoryItem}
    </td>
    {/if}
    {#if showStillCheckedOut}
      <td class="table-{#if result.isStillCheckedOut()}active{#else}success{/if}">
      {#if result.isStillCheckedOut()}
        {#icons/checkout}{/icons/checkout} Out
      {#else}
        {#icons/checkin}{/icons/checkin} In
      {/if}
      </td>
    {/if}
    <td>
      {#links/storageBlock storageBlock=result.getCheckedOutFrom()}{/links/storageBlock}
    </td>
    <td>
      {#when result.getCheckedOutFor().getType()}
      {#is OQM_ENTITY}
      {#interactingEntityRef entityRef=result.getCheckedOutFor().getEntity()}{/interactingEntityRef}
      {#is EXT_SYS_USER}
      {/when}
    </td>
    <td>
      {#interactingEntityRef entityRef=cdi:ItemCheckoutService.getCreateEvent(result.getId()).getEntity()}{/interactingEntityRef}
    </td>
    <td>
      {! TODO:: special styling !}
      {result.getDueBack()}
    </td>
    {#if actionType == 'full'}
    <td>
      <button type="button" class="btn btn-sm btn-info" title="View" data-bs-toggle="modal" data-bs-target="#itemCheckoutViewModal" onclick="ItemCheckoutView.setupView('{result.getId()}');">
        {#icons/view}{/icons/view}
      </button>
      {#if result.isStillCheckedOut()}
      <button type="button" class="btn btn-sm btn-warning" title="Checkin" data-bs-toggle="modal" data-bs-target="#itemCheckinModal" onclick="ItemCheckin.setupCheckinForm('{result.getId()}');">
        {#icons/checkin}{/icons/checkin}
      </button>
      {/if}
      <button type="button" class="btn btn-sm btn-danger" title="Remove" onclick="removeItem('{result.getId()}');">
        {#icons/remove}{/icons/remove}
      </button>
    </td>
    {#else if actionType == 'select'}
    <td class="d-grid gap-2">
      <button type="button" class="btn btn-sm btn-success" title="Select"
              data-bs-toggle="modal" data-bs-target="#{otherModalId}"
              onclick="">
        {#icons/select}{/icons/select} Select
      </button>
    </td>
    {/if}
  </tr>
  {/for}
  {/if}
  </tbody>
  <tfoot>
  <tr>
    <td colspan="7" class="text-center">
      {#paginationButtons searchFormId=searchFormId pagingCalculations=pagingCalculations}{/paginationButtons}
    </td>
  </tr>
  </tfoot>
