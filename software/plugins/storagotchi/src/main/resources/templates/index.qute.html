<!DOCTYPE html>
<html lang="en">
<head>
	<title>Storagotchi - Open QuarterMaster</title>
	<meta charset="UTF-8" />
	
	<link rel="stylesheet" href="/lib/xp.css/0.2.6/XP.css" />
	<style>
		dialog.window {
			border-width: 0;
		}
		#gameCanvas {
			width: 100%;
			min-height: 500px;
			/*border: 1px solid black;*/
		}
	</style>
</head>

<body class="surface">
<div class="window" style="width: 100%; height: 100%">
	<div class="title-bar">
		<div class="title-bar-text">
			Storagotchi
		</div>
		<div class="title-bar-controls">
			<button id="testModalOpenButton" aria-label="Help"></button>
			<button aria-label="Minimize" disabled></button>
			<button aria-label="Restore" disabled></button>
			<button aria-label="Close" disabled></button>
		</div>
	</div>
	<div class="window-body">
		<section class="tabs" style="max-width: 100%">
			<menu role="tablist" aria-label="Sample Tabs">
				<button role="tab" aria-selected="true" aria-controls="tab-A">Tab A</button>
				<button role="tab" aria-controls="tab-B">Tab B</button>
				<button role="tab" aria-controls="tab-C">Tab C</button>
			</menu>
			<!-- the tab content -->
			<article role="tabpanel" id="tab-A">
				<div id="gameCanvas"></div>
			</article>
			<article role="tabpanel" hidden id="tab-B">
				<h3>More...</h3>
				<p>This tab contains a GroupBox</p>
				<fieldset>
					<legend>Today's mood</legend>
					<div class="field-row">
						<input id="radio10" type="radio" name="fieldset-example2">
						<label for="radio10">Claire Saffitz</label>
					</div>
					<div class="field-row">
						<input id="radio11" type="radio" name="fieldset-example2">
						<label for="radio11">Brad Leone</label>
					</div>
					<div class="field-row">
						<input id="radio12" type="radio" name="fieldset-example2">
						<label for="radio12">Chris Morocco</label>
					</div>
					<div class="field-row">
						<input id="radio13" type="radio" name="fieldset-example2">
						<label for="radio13">Carla Lalli Music</label>
					</div>
				</fieldset>
			</article>
			<article role="tabpanel" hidden id="tab-C">
				<h3>Tab 3</h3>
				<p>Lorem Ipsum Dolor Sit</p>
			</article>
		</section>
	</div>
	<div class="status-bar">
		<p class="status-bar-field">Press F1 for help</p>
		<p class="status-bar-field">Slide 1</p>
		<p class="status-bar-field">CPU Usage: 14%</p>
		<p class="status-bar-field" style="max-width: 125px;"><progress></progress></p>
	</div>
</div>


<dialog class="window" style="width: 300px" id="testDialog">
	<div class="title-bar">
		<div class="title-bar-text">A Window With Stuff In It</div>
		<div class="title-bar-controls">
			<button type="button" aria-label="Minimize"></button>
			<button type="button" aria-label="Maximize"></button>
			<button type="button" aria-label="Close" class="modalClose"></button>
		</div>
	</div>
	<div class="window-body">
		<p>There's so much room for activities!</p>
		<button>Click me</button>
	</div>
</dialog>

<script src="/webjars/jquery/3.7.1/jquery.min.js"></script>
<script>
	const testDialog = $("#testDialog");
	
	const showButton = $("#testModalOpenButton");
	const closeButton = testDialog.find(".modalClose");
	
	// "Show the dialog" button opens the dialog modally
	showButton.on("click", () => {
		console.log("Opening test modal");
		testDialog[0].showModal();
	});
	
	// "Close" button closes the dialog
	closeButton.on("click", () => {
		console.log("Closing test modal");
		testDialog[0].close();
	});
	
	
	const tabs = document.querySelectorAll("menu[role=tablist]");
	
	for (let i = 0; i < tabs.length; i++) {
		const tab = tabs[i];
		
		const tabButtons = tab.querySelectorAll("menu[role=tablist] > button");
		
		tabButtons.forEach((btn) =>
			btn.addEventListener("click", (e) => {
				e.preventDefault();
				
				tabButtons.forEach((button) => {
					if (
						button.getAttribute("aria-controls") ===
						e.target.getAttribute("aria-controls")
					) {
						button.setAttribute("aria-selected", true);
						openTab(e, tab);
					} else {
						button.setAttribute("aria-selected", false);
					}
				});
			})
		);
	}
	
	function openTab(event, tab) {
		const articles = tab.parentNode.querySelectorAll('[role="tabpanel"]');
		articles.forEach((p) => {
			p.setAttribute("hidden", true);
		});
		const article = tab.parentNode.querySelector(
			`[role="tabpanel"]#${ event.target.getAttribute("aria-controls")}`
		);
		article.removeAttribute("hidden");
	}

</script>
<script type="module">
	import { Application, Assets, Container, Sprite } from '/lib/pixi/8.14.0/pixi.min.mjs';
	
	(async () => {
		let gameCanvas = document.getElementById("gameCanvas");
		// Create a new application
		const app = new Application();
		
		// Initialize the application
		await app.init({
			backgroundAlpha: 0,
			// background: '#ece9d8', //beige
			resizeTo: gameCanvas
		});
		
		// Append the application canvas to the document body
		gameCanvas.appendChild(app.canvas);
		
		// Create and add a container to the stage
		const container = new Container();
		
		
		app.stage.addChild(container);
		
		// Load the bunny texture
		const texture = await Assets.load('/media/sprites/storagotchi/storagotchi-0.png');
		
		// Create a 5x5 grid of bunnies in the container
		for (let i = 0; i < 25; i++) {
			const bunny = new Sprite(texture);
			
			bunny.x = (i % 5) * 40;
			bunny.y = Math.floor(i / 5) * 40;
			container.addChild(bunny);
		}
		
		// Move the container to the center
		container.x = app.screen.width / 2;
		container.y = app.screen.height / 2;
		
		// Center the bunny sprites in local container coordinates
		container.pivot.x = container.width / 2;
		container.pivot.y = container.height / 2;
		
		// Listen for animate update
		app.ticker.add((time) => {
			// Continuously rotate the container!
			// * use delta to create frame-independent transform *
			container.rotation -= 0.001 * time.deltaTime;
		});
	})();
</script>

</body>
</html>